# Sistema de InternacionalizaÃ§Ã£o (i18n)

## ğŸŒ VisÃ£o Geral

O sistema de internacionalizaÃ§Ã£o do Casa da Pedra suporta trÃªs idiomas: PortuguÃªs (padrÃ£o), Espanhol e InglÃªs, com detecÃ§Ã£o automÃ¡tica e persistÃªncia de preferÃªncias.

## ğŸ¯ Idiomas Suportados

| Idioma | CÃ³digo | URL | Status |
|--------|--------|-----|--------|
| PortuguÃªs | `pt` | `/` | âœ… PadrÃ£o |
| Espanhol | `es` | `/es` | âœ… Completo |
| InglÃªs | `en` | `/en` | âœ… Completo |

## ğŸ—ï¸ Arquitetura do Sistema

### Componentes Principais

#### 1. Store Pinia (useLocaleStore)
```typescript
// src/stores/locale.ts
export const useLocaleStore = defineStore('locale', () => {
  const currentLocale = ref<SupportedLocale>('pt')
  
  const setLocale = (newLocale: SupportedLocale) => {
    currentLocale.value = newLocale
    setStoredLocale(newLocale)
    document.documentElement.lang = newLocale
    
    // Sincronizar com Vue I18n
    try {
      const { locale } = useVueI18n()
      locale.value = newLocale
    } catch {
      // Vue I18n nÃ£o estÃ¡ disponÃ­vel ainda
    }
  }
})
```

#### 2. Composable (useI18n)
```typescript
// src/composables/useI18n.ts
export function useI18n() {
  const localeStore = useLocaleStore()
  
  const setLocale = (newLocale: SupportedLocale) => {
    localeStore.setLocale(newLocale)
    localeStore.forceSyncWithVueI18n()
    // LÃ³gica de redirecionamento...
  }
  
  return { locale, setLocale, getLocaleUrl }
}
```

#### 3. ConfiguraÃ§Ã£o Vue I18n
```typescript
// src/i18n/index.ts
const i18n = createI18n({
  legacy: false,
  locale: 'pt',
  fallbackLocale: 'pt',
  messages: { pt, es, en },
  globalInjection: true
})
```

## ğŸ”„ Fluxo de Funcionamento

### 1. InicializaÃ§Ã£o
```typescript
// main.ts
nextTick(() => {
  const localeStore = useLocaleStore()
  
  // Detectar idioma da rota atual
  const currentPath = window.location.pathname
  let routeLocale = 'pt'
  
  if (currentPath.startsWith('/es')) routeLocale = 'es'
  else if (currentPath.startsWith('/en')) routeLocale = 'en'
  
  localeStore.initializeLocale(routeLocale)
  localeStore.forceSyncWithVueI18n()
})
```

### 2. DetecÃ§Ã£o de Idioma
**Prioridade de detecÃ§Ã£o:**
1. **Rota atual** (`/es`, `/en`)
2. **localStorage** (`casadapedra-locale`)
3. **Navegador** (`navigator.language`)
4. **Fallback** (PortuguÃªs)

### 3. Troca de Idioma
```typescript
// NavHeader.vue
const changeLanguage = (code: string) => {
  setLocale(code as 'pt' | 'es' | 'en')
  languageDropdownOpen.value = false
}
```

## ğŸ“ Estrutura de Arquivos

### TraduÃ§Ãµes
```
src/i18n/
â”œâ”€â”€ index.ts              # ConfiguraÃ§Ã£o Vue I18n
â””â”€â”€ locales/
    â”œâ”€â”€ pt.json           # PortuguÃªs (padrÃ£o)
    â”œâ”€â”€ es.json           # Espanhol
    â””â”€â”€ en.json           # InglÃªs
```

### Componentes
```
src/
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ locale.ts         # Store Pinia para idiomas
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useI18n.ts        # Composable de internacionalizaÃ§Ã£o
â””â”€â”€ components/
    â””â”€â”€ layout/
        â””â”€â”€ NavHeader.vue  # Seletor de idiomas
```

## ğŸ“ Estrutura das TraduÃ§Ãµes

### Exemplo (pt.json)
```json
{
  "nav": {
    "tours": "ExcursÃµes",
    "accommodations": "Hospedagens",
    "transfers": "Traslados",
    "contact": "Contato",
    "cart": "Carrinho"
  },
  "home": {
    "hero": {
      "slide1": {
        "title": "Descubra as melhores experiÃªncias de viagem",
        "subtitle": "Reserve passeios incrÃ­veis, hospedagens Ãºnicas e traslados confiÃ¡veis",
        "cta": "Explorar Agora"
      }
    },
    "search": {
      "destination": "Destino",
      "destinationPlaceholder": "Para onde vocÃª quer ir?",
      "checkIn": "Check-in",
      "checkOut": "Check-out",
      "guests": "HÃ³spedes",
      "search": "Buscar",
      "advancedFilters": "Filtros avanÃ§ados"
    }
  }
}
```

## ğŸ¨ Interface do Seletor

### NavHeader.vue
```vue
<template>
  <div class="header__lang">
    <button 
      class="header__lang-button"
      @click="toggleLanguageDropdown"
      :aria-expanded="languageDropdownOpen"
    >
      <span class="fi fi-br" v-if="currentLanguage === 'PortuguÃªs'"></span>
      <span class="fi fi-es" v-else-if="currentLanguage === 'EspaÃ±ol'"></span>
      <span class="fi fi-us" v-else></span>
    </button>
    
    <div v-if="languageDropdownOpen" class="header__lang-dropdown">
      <button 
        v-for="lang in languages"
        :key="lang.code"
        @click="changeLanguage(lang.code)"
        class="header__lang-item"
      >
        <span :class="`fi fi-${lang.flag}`"></span>
      </button>
    </div>
  </div>
</template>
```

### CSS do Seletor
```css
.header__lang-button .fi {
  font-size: 1.5rem;
}

.header__lang-item {
  display: flex;
  justify-content: center;
  align-items: center;
}

.header__lang-item .fi {
  font-size: 1.5rem;
}
```

## ğŸ”§ Funcionalidades Implementadas

### âœ… Rotas EspecÃ­ficas
- **PortuguÃªs**: URLs limpos (`/tours`)
- **Outros idiomas**: URLs com prefixo (`/es/tours`, `/en/tours`)

### âœ… PersistÃªncia
- **localStorage**: Chave `casadapedra-locale`
- **RestauraÃ§Ã£o**: MantÃ©m idioma entre sessÃµes
- **Fallback**: PortuguÃªs se localStorage falhar

### âœ… DetecÃ§Ã£o AutomÃ¡tica
- **Navegador**: `navigator.language`
- **Mapeamento**: `pt-BR` â†’ `pt`, `es-ES` â†’ `es`, `en-US` â†’ `en`
- **Fallback**: PortuguÃªs se detecÃ§Ã£o falhar

### âœ… SincronizaÃ§Ã£o
- **Vue I18n**: `locale.value` sincronizado
- **HTML lang**: Atributo atualizado
- **Store**: Estado centralizado no Pinia

## ğŸ› Problemas Resolvidos

### 1. Contexto de Setup
**Problema**: `useI18n` sendo chamado fora do contexto de setup
**SoluÃ§Ã£o**: Criado store Pinia para gerenciamento global

### 2. SincronizaÃ§Ã£o
**Problema**: Idioma nÃ£o sincronizava entre store e Vue I18n
**SoluÃ§Ã£o**: Implementada funÃ§Ã£o `forceSyncWithVueI18n()`

### 3. TraduÃ§Ãµes Faltantes
**Problema**: Warnings de traduÃ§Ã£o faltante
**SoluÃ§Ã£o**: Adicionadas todas as traduÃ§Ãµes em `es.json` e `en.json`

### 4. Bandeiras
**Problema**: Bandeira nÃ£o atualizava ao trocar idioma
**SoluÃ§Ã£o**: Watcher reativo no NavHeader

## ğŸ§ª Testes

### URLs de Teste
- **PortuguÃªs**: `http://localhost:5173/`
- **Espanhol**: `http://localhost:5173/es`
- **InglÃªs**: `http://localhost:5173/en`

### CenÃ¡rios de Teste
1. **Acesso direto**: `/es` deve carregar em espanhol
2. **Troca de idioma**: Seletor deve atualizar bandeira
3. **PersistÃªncia**: Recarregar pÃ¡gina mantÃ©m idioma
4. **Fallback**: Idioma do navegador como fallback

## ğŸ“Š MÃ©tricas

### Performance
- **InicializaÃ§Ã£o**: < 100ms
- **Troca de idioma**: < 200ms
- **SincronizaÃ§Ã£o**: < 50ms

### Cobertura de TraduÃ§Ã£o
- **PortuguÃªs**: 100% (padrÃ£o)
- **Espanhol**: 100% (completo)
- **InglÃªs**: 100% (completo)

## ğŸ”® PrÃ³ximos Passos

### Melhorias Futuras
- [ ] Suporte a mais idiomas (FrancÃªs, Italiano)
- [ ] TraduÃ§Ã£o automÃ¡tica de conteÃºdo dinÃ¢mico
- [ ] Cache de traduÃ§Ãµes
- [ ] Lazy loading de traduÃ§Ãµes
- [ ] ValidaÃ§Ã£o de traduÃ§Ãµes faltantes
